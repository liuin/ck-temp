webpackJsonp([45],{"8F81":function(t,e){},vAiU:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("4YfN"),l=a.n(i),s=a("9rMa"),o={name:"messageListAdd",data:function(){return{loading:!1,dialogImageUrl:"",dialogVisible:!1,region:[],pushTime:"",activeTime:[],tagsItem:[],tagsItemValue:"",tagsItemValueType:0}},created:function(){var t=this;this.reset(),this.templateShow.id=this.$route.query.id,this.loading=!0,this.$store.dispatch("message/templateShow").then(function(e){for(var a in t.templateUpdate)t.templateUpdate.hasOwnProperty(a)&&void 0!=t.templateShowRes[a]&&(t.templateUpdate[a]=t.templateShowRes[a]);t.pushTime=new Date(1e3*t.templateUpdate.push_time),t.activeTime=[new Date(1e3*t.templateUpdate.activity_start_time),new Date(1e3*t.templateUpdate.activity_end_time)],t.uploadImg.fileList=[{name:"",url:t.templateUpdate.cover_image}],0==t.templateUpdate.push_tags_type?t.tagsItemValue=0:t.tagsItemValue=t.templateUpdate.push_tags_type+"-"+t.templateUpdate.push_tags_id,t.region=[t.templateUpdate.province.toString(),t.templateUpdate.city.toString()],t.loading=!1}),this.categoryList.page=1,this.categoryList.count=100,this.$store.dispatch("message/categoryList"),this.$store.dispatch("platform/list");this.$store.dispatch("tags/labelList",{type:1,page:1,count:100,total:1}).then(function(e){e.list.map(function(e){t.tagsItem.push({value:"1-"+e.id,label:"司机 ("+e.title+")"})})});this.$store.dispatch("tags/labelList",{type:2,page:1,count:100,total:1}).then(function(e){e.list.map(function(e){t.tagsItem.push({value:"2-"+e.id,label:"厂商 ("+e.title+")"})})})},watch:{activeTime:function(t,e){this.templateUpdate.activity_start_time=t[0].getTime()/1e3,this.templateUpdate.activity_end_time=t[1].getTime()/1e3},pushTime:function(t){this.templateUpdate.push_time=t.getTime()/1e3},tagsItemValue:function(t){if(0!=t){var e=t.split("-");this.templateUpdate.push_tags_id=e[1],this.templateUpdate.push_tags_type=parseInt(e[0]),this.tagsItemValueType=e[0]}else this.templateUpdate.push_tags_id=0,this.tagsItemValueType=0,this.templateUpdate.push_tags_type=t}},computed:l()({},Object(s.c)("message",["templateShow","templateShowRes","templateUpdate","categoryList","categoryListRes"]),Object(s.c)("uploadImg",["uploadImg"]),Object(s.c)("platform",{platformListRes:function(t){return t.list.res}})),methods:{reset:function(){this.templateUpdate.category_id="",this.templateUpdate.title="",this.templateUpdate.content="",this.uploadImg.fileList=[]},save:function(t){var e=this;"send"==t&&this.$confirm("本消息将于 "+this.pushTime.toLocaleString()+" 推送，是否确认？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(t){e.templateUpdate.state=2,e.uploadImg.fileList.length>0&&e.$store.dispatch("uploadImg/upImg").then(function(t){t&&(e.templateUpdate.cover_image=t.path),e.$store.dispatch("message/templateUpdate").then(function(t){e.$alert("修改成功","",{confirmButtonText:"确定",type:"success",callback:function(t){e.reset(),e.$router.back()}})})})}).catch(function(){}),"drafts"==t&&(this.templateUpdate.state=1,this.uploadImg.fileList.length>0&&this.$store.dispatch("uploadImg/upImg").then(function(t){t&&(e.templateUpdate.cover_image=t.path),e.templateUpdate.cover_image=t.path,e.$store.dispatch("message/templateUpdate").then(function(t){e.$alert("保存到草稿成功","",{confirmButtonText:"确定",type:"success",callback:function(t){e.reset(),e.$router.back()}})})}))},regionCahge:function(t,e){this.templateUpdate.province=t[0],this.templateUpdate.city=t[1],console.log(t)},upSuccess:function(t,e,a){this.$store.commit("uploadImg/fileList",a)},handleRemove:function(t,e){this.$store.commit("uploadImg/fileList",e)},handlePictureCardPreview:function(t){this.dialogImageUrl=t.url,this.dialogVisible=!0}},mounted:function(){}},p={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"message-list-add"},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"box"},[a("el-form",{attrs:{"label-position":"right","label-width":"120px"}},[a("el-form-item",{attrs:{label:"标题"}},[a("el-input",{model:{value:t.templateUpdate.title,callback:function(e){t.$set(t.templateUpdate,"title",e)},expression:"templateUpdate.title"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"分类"}},[a("el-select",{model:{value:t.templateUpdate.category_id,callback:function(e){t.$set(t.templateUpdate,"category_id",e)},expression:"templateUpdate.category_id"}},t._l(t.categoryListRes,function(t,e){return a("el-option",{key:e,attrs:{label:t.title,value:t.id}})}))],1),t._v(" "),a("el-form-item",{attrs:{label:"封面图片"}},[a("el-upload",{attrs:{action:t.api.url.uploadImg,"list-type":"picture-card","on-preview":t.handlePictureCardPreview,"on-remove":t.handleRemove,"on-success":t.upSuccess,"file-list":t.uploadImg.fileList,limit:1}},[a("i",{staticClass:"el-icon-plus"})]),t._v(" "),a("el-dialog",{attrs:{visible:t.dialogVisible,size:"tiny"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("img",{attrs:{width:"100%",src:t.dialogImageUrl,alt:""}})])],1),t._v(" "),a("el-row",[a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:"推送用户"}},[a("el-select",{attrs:{filterable:""},model:{value:t.tagsItemValue,callback:function(e){t.tagsItemValue=e},expression:"tagsItemValue"}},[a("el-option",{attrs:{value:0,label:"全部"}}),t._v(" "),t._l(t.tagsItem,function(t){return a("el-option",{key:t.value,attrs:{value:t.value,label:t.label}})})],2)],1),t._v(" "),"1"==t.tagsItemValueType?a("el-form-item",{attrs:{label:"推送地区"}},[a("Region",{attrs:{clearable:!0,selected:t.region,limitLen:2},on:{"update:selected":function(e){t.region=e},change:t.regionCahge}})],1):t._e(),t._v(" "),"2"==t.tagsItemValueType?a("el-form-item",{attrs:{label:"推送平台"}},[a("el-select",{attrs:{filterable:""},model:{value:t.templateUpdate.platform_id,callback:function(e){t.$set(t.templateUpdate,"platform_id",e)},expression:"templateUpdate.platform_id"}},t._l(t.platformListRes,function(t){return a("el-option",{key:t.id,attrs:{value:t.id,label:t.title}})}))],1):t._e()],1),t._v(" "),a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:"推送时间"}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间"},model:{value:t.pushTime,callback:function(e){t.pushTime=e},expression:"pushTime"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"活动时间"}},[a("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.activeTime,callback:function(e){t.activeTime=e},expression:"activeTime"}})],1)],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"正文"}},[a("el-input",{attrs:{type:"textarea",rows:4},model:{value:t.templateUpdate.content,callback:function(e){t.$set(t.templateUpdate,"content",e)},expression:"templateUpdate.content"}})],1),t._v(" "),a("el-form-item",{attrs:{label:""}},[a("el-button",{attrs:{size:"medium",type:"primary"},on:{click:function(e){t.save("send")}}},[t._v("发布")]),t._v(" "),a("el-button",{attrs:{size:"medium"},on:{click:function(e){t.save("drafts")}}},[t._v("保存至草稿箱")])],1)],1)],1)])},staticRenderFns:[]};var n=a("Z0/y")(o,p,!1,function(t){a("8F81")},"data-v-2691dc7e",null);e.default=n.exports}});
//# sourceMappingURL=45.fe64623aabb7798ea86c.js.map