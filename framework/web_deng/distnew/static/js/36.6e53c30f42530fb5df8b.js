webpackJsonp([36],{"H+7d":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("4YfN"),l=a.n(i),s=a("9rMa"),r={name:"messageListAdd",data:function(){return{loading:!0,dialogImageUrl:"",dialogVisible:!1,region:[],pushTime:"",activeTime:[],tagsItem:[],tagsItemValue:"",tagsItemValueType:0}},created:function(){var e=this;this.categoryList.page=1,this.categoryList.count=100,this.$store.dispatch("message/categoryList"),this.$store.dispatch("platform/list");this.$store.dispatch("tags/labelList",{type:1,page:1,count:100,total:1}).then(function(t){t.list.map(function(t){e.tagsItem.push({value:"1-"+t.id,label:"司机 ("+t.title+")"})})});this.$store.dispatch("tags/labelList",{type:2,page:1,count:100,total:1}).then(function(t){t.list.map(function(t){e.tagsItem.push({value:"2-"+t.id,label:"厂商 ("+t.title+")"})})})},watch:{activeTime:function(e,t){this.templateCreate.activity_start_time=e[0].getTime()/1e3,this.templateCreate.activity_end_time=e[1].getTime()/1e3},pushTime:function(e){this.templateCreate.push_time=e.getTime()/1e3},tagsItemValue:function(e){if(0!=e){var t=e.split("-");this.templateCreate.push_tags_id=t[1],this.templateCreate.push_tags_type=parseInt(t[0]),this.tagsItemValueType=t[0]}else this.templateCreate.push_tags_id=0,this.tagsItemValueType=0,this.templateCreate.push_tags_type=e}},computed:l()({},Object(s.c)("message",["templateCreate","categoryList","categoryListRes"]),Object(s.c)("uploadImg",["uploadImg"]),Object(s.c)("platform",{platformListRes:function(e){return e.list.res}})),methods:{reset:function(){this.templateCreate.category_id="",this.templateCreate.title="",this.templateCreate.content="",this.uploadImg.fileList=[]},save:function(e){var t=this;"send"==e&&this.$confirm("本消息将于 "+this.pushTime.toLocaleString()+" 推送，是否确认？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(e){t.templateCreate.state=2,t.uploadImg.fileList.length>0&&t.$store.dispatch("uploadImg/upImg").then(function(e){t.templateCreate.cover_image=e.path,t.$store.dispatch("message/templateCreate").then(function(e){t.$alert("添加成功","",{confirmButtonText:"确定",type:"success",callback:function(e){t.reset(),t.$router.back()}})})})}),"drafts"==e&&(this.templateCreate.state=1,this.uploadImg.fileList.length>0&&this.$store.dispatch("uploadImg/upImg").then(function(e){t.templateCreate.cover_image=e.path,t.$store.dispatch("message/templateCreate").then(function(e){t.$alert("保存到草稿成功","",{confirmButtonText:"确定",type:"success",callback:function(e){t.reset(),t.$router.back()}})})}))},regionCahge:function(e,t){this.templateCreate.province=e[0],this.templateCreate.city=e[1]},upSuccess:function(e,t,a){this.$store.commit("uploadImg/fileList",a)},handleRemove:function(e,t){this.$store.commit("uploadImg/fileList",t)},handlePictureCardPreview:function(e){this.dialogImageUrl=e.url,this.dialogVisible=!0}},mounted:function(){}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"message-list-add"},[a("div",{staticClass:"box"},[a("el-form",{attrs:{"label-position":"right","label-width":"120px"}},[a("el-form-item",{attrs:{label:"标题"}},[a("el-input",{model:{value:e.templateCreate.title,callback:function(t){e.$set(e.templateCreate,"title",t)},expression:"templateCreate.title"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"分类"}},[a("el-select",{model:{value:e.templateCreate.category_id,callback:function(t){e.$set(e.templateCreate,"category_id",t)},expression:"templateCreate.category_id"}},e._l(e.categoryListRes,function(e,t){return a("el-option",{key:t,attrs:{label:e.title,value:e.id}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"封面图片"}},[a("el-upload",{attrs:{action:e.api.url.uploadImg,"list-type":"picture-card","on-preview":e.handlePictureCardPreview,"on-remove":e.handleRemove,"on-success":e.upSuccess,"file-list":e.uploadImg.fileList,limit:1}},[a("i",{staticClass:"el-icon-plus"})]),e._v(" "),a("el-dialog",{attrs:{visible:e.dialogVisible,size:"tiny"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:"推送用户"}},[a("el-select",{attrs:{filterable:""},model:{value:e.tagsItemValue,callback:function(t){e.tagsItemValue=t},expression:"tagsItemValue"}},[a("el-option",{attrs:{value:0,label:"全部"}}),e._v(" "),e._l(e.tagsItem,function(e){return a("el-option",{key:e.value,attrs:{value:e.value,label:e.label}})})],2)],1),e._v(" "),"1"==e.tagsItemValueType?a("el-form-item",{attrs:{label:"推送地区"}},[a("Region",{attrs:{clearable:!0,selected:e.region,limitLen:2},on:{change:e.regionCahge}})],1):e._e(),e._v(" "),"2"==e.tagsItemValueType?a("el-form-item",{attrs:{label:"推送平台"}},[a("el-select",{attrs:{filterable:""},model:{value:e.templateCreate.platform_id,callback:function(t){e.$set(e.templateCreate,"platform_id",t)},expression:"templateCreate.platform_id"}},e._l(e.platformListRes,function(e){return a("el-option",{key:e.id,attrs:{value:e.id,label:e.title}})}))],1):e._e()],1),e._v(" "),a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:"推送时间"}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间"},model:{value:e.pushTime,callback:function(t){e.pushTime=t},expression:"pushTime"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"活动时间"}},[a("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.activeTime,callback:function(t){e.activeTime=t},expression:"activeTime"}})],1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"正文"}},[a("el-input",{attrs:{type:"textarea",rows:4},model:{value:e.templateCreate.content,callback:function(t){e.$set(e.templateCreate,"content",t)},expression:"templateCreate.content"}})],1),e._v(" "),a("el-form-item",{attrs:{label:""}},[a("el-button",{attrs:{size:"medium",type:"primary"},on:{click:function(t){e.save("send")}}},[e._v("发布")]),e._v(" "),a("el-button",{attrs:{size:"medium"},on:{click:function(t){e.save("drafts")}}},[e._v("保存至草稿箱")])],1)],1)],1)])},staticRenderFns:[]};var n=a("Z0/y")(r,o,!1,function(e){a("rDH+")},"data-v-378ec8f8",null);t.default=n.exports},"rDH+":function(e,t){}});
//# sourceMappingURL=36.6e53c30f42530fb5df8b.js.map